<!DOCTYPE html>
<html lang="uk">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ team.name }} - Teamnity</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/all.min.css' %}">
    <link rel="icon" href="{% static 'img/favicon.png' %}" type="image/png">
    <style>
        .sidebar {
            min-height: 100vh;
        }

        .profile-img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 50%;
        }

        .logo-img {
            max-width: 100%;
            margin: 10px auto;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar p-3 position-relative">
                <img src="{% static 'img/teamnity_logo.png' %}" alt="Логотип Teamnity" class="logo-img">
                <div class="list-group">
                    <a href="{% url 'user_profile' username=request.user.username %}" class="list-group-item list-group-item-action">Мій профіль</a>
                    <a href="{% url 'search' %}" class="list-group-item list-group-item-action">Пошук</a>
                    <a href="{% url 'teams:teams' %}" class="list-group-item list-group-item-action active">Команди</a>
                    <!--<a href="./Friends.html" class="list-group-item list-group-item-action">Друзі</a>
                    <a href="./Invitation.html" class="list-group-item list-group-item-action">Запрошення</a>-->
                </div>

                <div class="profile-section position-absolute bottom-0 start-0 w-100 p-3">
                    <div class="d-flex align-items-center">
                        <a href="{% url 'user_profile' username=request.user.username %}" class="d-flex align-items-center text-decoration-none text-dark">
                            <img src="{% if request.user.userprofile.profile_picture %}{{ request.user.userprofile.profile_picture.url }}{% else %}{% static 'img/user_logo.png' %}{% endif %}" style="height:70px" class="rounded-circle" alt="Фото мого профілю">
                            <div class="ms-3 profile-info">
                                <h5 class="mb-0">{{ request.user.username }}</h5>
                            </div>
                        </a>
                    </div>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
                {% if messages %}
                    <ul class="messages list-unstyled">
                        {% for message in messages %}
                            <li class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}

                <div class="d-flex justify-content-between align-items-center mb-3">
                    {% if is_owner %}
                        <a href="{% url 'teams:edit_team' pk=team.pk %}" class="btn btn-outline-primary">
                            Редагувати <i class="fa-solid fa-pen"></i>
                        </a>
                    {% endif %}
                </div>

                <div class="card p-4 mb-3">
                    <div class="d-flex align-items-start justify-content-between">
                        <div class="d-flex align-items-start">
                            <img src="{% if team.profile_picture %}{{ team.profile_picture.url }}{% else %}{% static 'img/team_logo.png' %}{% endif %}" alt="Фото профілю команди" class="profile-img me-4">

                            <div>
                                <h4 class="mb-2">{{ team.name }}</h4>
                                <p class="mb-1"><i class="fa-solid fa-user-group"></i> {{ team.memberships.count }}</p>
                                {% if team.location %}
                                    <p class="mb-1"><i class="fa-solid fa-location-dot"></i> {{ team.location }}</p>
                                {% endif %}
                                {% if team.email and team.is_email_public %}
                                    <p class="mb-2"><i class="fa-solid fa-envelope"></i> {{ team.email }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% if not is_owner %}
                            {% if is_member %}
                                <form action="{% url 'teams:leave_team' pk=team.pk %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger">Вийти <i class="fa-solid fa-right-from-bracket"></i></button>
                                </form>
                            {% else %}
                                {% if team.is_public %}
                                    <form action="{% url 'teams:join_team' pk=team.pk %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-success">Приєднатися <i class="fa-solid fa-user-plus"></i></button>
                                    </form>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    </div>

                    <hr>

                    {% if team.description %}
                        <h5>Опис</h5>
                        <p>{{ team.description }}</p>
                    {% endif %}

                    {% if team.tags.all %}
                        <div class="mb-3">
                            <h5>Теги</h5>
                            {% for tag in team.tags.all %}
                                <span class="badge bg-primary me-1">{{ tag.name }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% if team.telegram or team.discord or team.instagram or team.github or team.linkedin %}
                        <div class="social-links">
                            {% if team.telegram %}<i class="fa-brands fa-telegram"></i> <a href="{{ team.telegram }}" target="_blank" rel="noopener" class="text-decoration-none">Telegram</a>{% endif %}
                            {% if team.discord %}<i class="fa-brands fa-discord"></i> <a href="{{ team.discord }}" target="_blank" rel="noopener" class="text-decoration-none">Discord</a>{% endif %}
                            {% if team.instagram %}<i class="fa-brands fa-instagram"></i> <a href="{{ team.instagram }}" target="_blank" rel="noopener" class="text-decoration-none">Instagram</a>{% endif %}
                            {% if team.github %}<i class="fa-brands fa-github"></i> <a href="{{ team.github }}" target="_blank" rel="noopener" class="text-decoration-none">GitHub</a>{% endif %}
                            {% if team.linkedin %}<i class="fa-brands fa-linkedin"></i> <a href="{{ team.linkedin }}" target="_blank" rel="noopener" class="text-decoration-none">LinkedIn</a>{% endif %}
                        </div>
                    {% endif %}
                </div>

                <div class="card p-4 mb-3">
                    <h5 class="mb-3">Учасники команд</h5>

                    {% for membership in page_obj %}
                        <div class="card p-3 mb-3">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="d-flex align-items-start">
                                    <a href="{% url 'user_profile' username=membership.user.username %}" class="d-flex align-items-start text-decoration-none text-dark">
                                        <img src="{% if membership.user.userprofile.profile_picture %}{{ membership.user.userprofile.profile_picture.url }}{% else %}{% static 'img/user_logo.png' %}{% endif %}" style="height:70px" class="rounded-circle" alt="Фото учасника">
                                        <div class="ps-2">
                                            <div class="d-flex align-items-center mb-1">
                                                <h5 class="mb-0 me-2">{{ membership.user.username }}</h5>
                                                {% if membership.role == 'owner' %}
                                                    <span class="badge bg-success">Власник</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">Учасник</span>
                                                {% endif %}
                                            </div>
                                            {% if membership.user.userprofile.full_name %}
                                                <div>{{ membership.user.userprofile.full_name }}</div>
                                            {% endif %}
                                            {% if membership.user.userprofile.location %}
                                                <div class="mb-2"><i class="fa-solid fa-location-dot"></i> {{ membership.user.userprofile.location }}</div>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>

                                
                                {% if is_owner and membership.user != team.owner %}
                                    <form action="{% url 'teams:remove_member' team_pk=team.pk member_pk=membership.user.pk %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-danger btn-sm" title="Видалити учасника">
                                            <i class="fa-solid fa-user-minus"></i>
                                        </button>
                                    </form>
                                {% endif %}
                            </div>

                            <!--<p class="mt-2">Опис учасника.</p>-->

                            {% if membership.user.userprofile.tags.all %}
                                <div class="mb-2">
                                    {% for tag in membership.user.userprofile.tags.all %}
                                        <span class="badge bg-primary me-1">{{ tag.name }}</span>
                                    {% endfor %}
                                </div>
                            {% endif %}

                            {% if membership.user.userprofile.telegram or membership.user.userprofile.discord or membership.user.userprofile.instagram or membership.user.userprofile.github or membership.user.userprofile.linkedin %}
                                <div class="social-links">
                                    {% if membership.user.userprofile.telegram %}<i class="fa-brands fa-telegram"></i> <a href="{{ membership.user.userprofile.telegram }}" target="_blank" rel="noopener" class="text-decoration-none">Telegram</a>{% endif %}
                                    {% if membership.user.userprofile.discord %}<i class="fa-brands fa-discord"></i> <a href="{{ membership.user.userprofile.discord }}" target="_blank" rel="noopener" class="text-decoration-none">Discord</a>{% endif %}
                                    {% if membership.user.userprofile.instagram %}<i class="fa-brands fa-instagram"></i> <a href="{{ membership.user.userprofile.instagram }}" target="_blank" rel="noopener" class="text-decoration-none">Instagram</a>{% endif %}
                                    {% if membership.user.userprofile.github %}<i class="fa-brands fa-github"></i> <a href="{{ membership.user.userprofile.github }}" target="_blank" rel="noopener" class="text-decoration-none">GitHub</a>{% endif %}
                                    {% if membership.user.userprofile.linkedin %}<i class="fa-brands fa-linkedin"></i> <a href="{{ membership.user.userprofile.linkedin }}" target="_blank" rel="noopener" class="text-decoration-none">LinkedIn</a>{% endif %}
                                </div>
                            {% endif %}
                        </div>
                    {% empty %}
                        <p class="text-muted ms-3">У цій команді поки немає учасників.</p>
                    {% endfor %}

                    {% if is_paginated %}
                        <nav aria-label="Page navigation for members" class="mt-3">
                            <ul class="pagination justify-content-center">
                                {% if page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link" aria-hidden="true">&laquo;</span>
                                    </li>
                                {% endif %}

                                {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                        <li class="page-item active" aria-current="page"><span class="page-link">{{ num }}</span></li>
                                    {% elif num == 1 or num == page_obj.paginator.num_pages %}
                                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                                    {% elif num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
                                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                                    {% endif %}
                                {% endfor %}

                                {% if page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link" aria-hidden="true">&raquo;</span>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    {% endif %}
                </div>


            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
</body>
</html>